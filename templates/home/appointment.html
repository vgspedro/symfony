{%set products  = false %}

{% for category in categories %}
    {% if category.no_stock == 0 %}
		{%set products = true %}
	{% endif%}
{% endfor %}

{% if products == true %}
<section class="ftco-section ftco-booking bg-light">
    <div class="container ftco-relative">
    	<div class="row justify-content-center pb-3">
         	<div class="col-md-10 heading-section text-center ftco-animate">
          		<span class="subheading">{%trans%} link.booking{% endtrans %}</span>
            	<h2 class="mb-4">{%trans%} info.make_reservation {% endtrans %}</h2>
            	<p>{%trans%} info.fill_all{% endtrans %}</p>
          	</div>
        </div>
        <h3 class="vr">{%trans%} info.call_us {% endtrans %}: {{company.telephone}}</h3>
    		<div class="row justify-content-center">
    			<div class="col-md-10 ftco-animate">

    				<form action="#" class="appointment-form">
	            		<div class="row">
	            			<div class="col-sm-12">
	                			<div class="form-group">
			              			<div class="select-wrap">
                      					<div class="icon">
                      						<span class="ion-ios-arrow-down"></span>
                      					</div>
                      					<select name="category" class="form-control">
											<option value="">{% trans %}part_seven.tour{% endtrans %}</option>
          									{% for category in categories %}
            								{% if category.no_stock == 0 %}          						
          									<option value="{{category.id}}">{{category.name}}</option>
			          						{% endif%}
         									{% endfor %}
                      					</select>
                    				</div>
			            		</div>
	              			</div>
			              	<div class="col-sm-4">
			                	<div class="form-group">
					            	<input type="number" name="adult" class="form-control" placeholder="{% trans %}part_seven.adult{%endtrans %}">
					        	</div>
			              	</div>
			              	<div class="col-sm-4">
			                	<div class="form-group">
					             	<input type="number" name="children" class="form-control" placeholder="{% trans %}part_seven.children{%endtrans %}">
					            </div>
			              	</div>
			              	<div class="col-sm-4">
			                	<div class="form-group">
			                  		<input type="number" name="baby" class="form-control" placeholder="{% trans %}part_seven.baby{%endtrans %}">
			                	</div>    
			              	</div>
			              	<div class="col-md-12">
			              		<div class="form-group"></div>
			              	</div>
				        </div>
		        		<div class="form-group">

	             			<span style="display:table"  onclick="getAvailability()" class="btn btn-primary btn-outline-primary px-4 py-2" data-to_ggle="modal" data-t_arget="#fsModal">{% trans %}part_seven.get_available{% endtrans %}</span>
	            		</div>
	        		</form>
    			</div>
    		</div>
    	</div>
</section>

<script>

function getAvailability(){ 
  var week = ''
	
  if( $('[name=category]').val() && $('[name=adult]').val() > 0){
		pax = Number($('[name=adult]').val()) + Number($('[name=children]').val()) + Number($('[name=baby]').val())
 		$('#ftco-loader').css({'opacity' : '0.7','visibility' : 'visible','z-index' : 9999})
		setTimeout(function(){
    	$.ajax({  
      url:'{{ path('available_by_period') }}',
      type: "POST",
      data:$('.appointment-form').serialize(),
      cache:false,
      success: function(data){ 
      //console.log(data) 
        $('#ftco-loader').css({'opacity' : 0,'visibility' : 'hidden','z-index' : 1000})
        if (data.status == 1){
          initializeDateTimePicker(data.data.available_dates)
          //console.log(data)
          $('#fsModal').modal('show')
          buildWeekTemplate(data.data.week)
        
        }
        
        else{
         alert('no availability')
        
        }
      },
      error:function(data){
        $('.w3-overlay').hide()
        $('#modal-error').show()
      }
    })
  }, 500)

	}
	else{
		alert('cate needed or adults')
	}
}




function buildWeekTemplate(week){


console.log(week)
  var week_view =''
  var next ='' 
  var day =''
  var hour =''


  for (var k in week){
    for (var j in week[k].event)   
      hour+= '<div data-evt="'+week[k].event[j].id+'" data-date="'+week[k].event[j].date+' '+week[k].event[j].hour+'" onclick="getEvent(this)" class="mb-2 btn btn-primary btn-outline-primary px-1 py-1 pointer w-54 h-54" style="border: 1px solid #1089ff !important"><i class="icon-clock-o"></i><br>'+week[k].event[j].hour+'</div><br>' 

    day+='<div class="col-1-7" data-date=""><p class="mt-2">'+week[k].day_week+'</p>'+hour+'</div>'
    hour=''
    }


  $('.set-weeks').html(day)

}


</script>


{% include 'home/modal.html' %}

{%else%}

{% include 'home/map.html' %}

{%endif%}
